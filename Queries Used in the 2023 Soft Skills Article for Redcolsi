
//Mexxico query

let
    Source = Json.Document(Web.Contents("https://api.adzuna.com/v1/api/jobs/mx/search/1?app_id=4dc3e42c&app_key=insertyourapi&results_per_page=50&what=developer&where=mexico&content-type=application/jso")),
    #"Converted to Table" = Table.FromRecords({Source}),
    #"Expanded results" = Table.ExpandListColumn(#"Converted to Table", "results"),
    #"Expanded results1" = Table.ExpandRecordColumn(#"Expanded results", "results", {"latitude", "longitude", "redirect_url", "contract_time", "id", "company", "salary_max", "description", "__CLASS__", "salary_min", "created", "adref", "salary_is_predicted", "category", "location", "title"}, {"results.latitude", "results.longitude", "results.redirect_url", "results.contract_time", "results.id", "results.company", "results.salary_max", "results.description", "results.__CLASS__", "results.salary_min", "results.created", "results.adref", "results.salary_is_predicted", "results.category", "results.location", "results.title"}),
    #"Expanded results.company" = Table.ExpandRecordColumn(#"Expanded results1", "results.company", {"__CLASS__", "display_name"}, {"results.company.__CLASS__", "results.company.display_name"}),
    #"Expanded results.category" = Table.ExpandRecordColumn(#"Expanded results.company", "results.category", {"tag", "label", "__CLASS__"}, {"results.category.tag", "results.category.label", "results.category.__CLASS__"}),
    #"Expanded results.location" = Table.ExpandRecordColumn(#"Expanded results.category", "results.location", {"__CLASS__", "area", "display_name"}, {"results.location.__CLASS__", "results.location.area", "results.location.display_name"}),
    #"Expanded results.location.area" = Table.ExpandListColumn(#"Expanded results.location", "results.location.area"),
    #"Changed Type" = Table.TransformColumnTypes(#"Expanded results.location.area",{{"results.latitude", type number}, {"results.longitude", type number}, {"results.redirect_url", type text}, {"results.contract_time", type any}, {"results.id", Int64.Type}, {"results.company.__CLASS__", type text}, {"results.company.display_name", type text}, {"results.salary_max", type any}, {"results.description", type text}, {"results.__CLASS__", type text}, {"results.salary_min", type any}, {"results.created", type datetime}, {"results.adref", type text}, {"results.salary_is_predicted", Int64.Type}, {"results.category.tag", type text}, {"results.category.label", type text}, {"results.category.__CLASS__", type text}, {"results.location.__CLASS__", type text}, {"results.location.area", type text}, {"results.location.display_name", type text}, {"results.title", type text}, {"count", Int64.Type}, {"__CLASS__", type text}, {"mean", type number}})
in
    #"Changed Type"
    
 //canada query
let
    Source = Json.Document(Web.Contents("https://api.adzuna.com/v1/api/jobs/ca/search/1?app_id=4dc3e42c&app_key=insertyourapi&results_per_page=50&what=developer&where=canada&content-type=application/json")),
    #"Converted to Table" = Table.FromRecords({Source}),
    #"Expanded results" = Table.ExpandListColumn(#"Converted to Table", "results"),
    #"Expanded results1" = Table.ExpandRecordColumn(#"Expanded results", "results", {"adref", "created", "company", "redirect_url", "title", "__CLASS__", "category", "location", "id", "salary_is_predicted", "description", "latitude", "longitude"}, {"results.adref", "results.created", "results.company", "results.redirect_url", "results.title", "results.__CLASS__", "results.category", "results.location", "results.id", "results.salary_is_predicted", "results.description", "results.latitude", "results.longitude"}),
    #"Expanded results.location" = Table.ExpandRecordColumn(#"Expanded results1", "results.location", {"display_name", "__CLASS__", "area"}, {"results.location.display_name", "results.location.__CLASS__", "results.location.area"}),
    #"Expanded results.location.area" = Table.ExpandListColumn(#"Expanded results.location", "results.location.area"),
    #"Expanded results.category" = Table.ExpandRecordColumn(#"Expanded results.location.area", "results.category", {"label", "tag", "__CLASS__"}, {"results.category.label", "results.category.tag", "results.category.__CLASS__"}),
    #"Expanded results.company" = Table.ExpandRecordColumn(#"Expanded results.category", "results.company", {"__CLASS__", "display_name"}, {"results.company.__CLASS__", "results.company.display_name"})
in
    #"Expanded results.company"
 //us query with the append
 let
    Source = Json.Document(Web.Contents("https://api.adzuna.com/v1/api/jobs/us/search/1?app_id=insertyourapi&results_per_page=50&what=developer&where=united+states+mexico&content-type=application/json")),
    #"Converted to Table" = Table.FromRecords({Source}),
    #"Expanded results" = Table.ExpandListColumn(#"Converted to Table", "results"),
    #"Expanded results1" = Table.ExpandRecordColumn(#"Expanded results", "results", {"latitude", "created", "salary_min", "description", "id", "salary_is_predicted", "company", "redirect_url", "longitude", "contract_type", "title", "__CLASS__", "adref", "contract_time", "category", "salary_max", "location"}, {"results.latitude", "results.created", "results.salary_min", "results.description", "results.id", "results.salary_is_predicted", "results.company", "results.redirect_url", "results.longitude", "results.contract_type", "results.title", "results.__CLASS__", "results.adref", "results.contract_time", "results.category", "results.salary_max", "results.location"}),
    #"Expanded results.company" = Table.ExpandRecordColumn(#"Expanded results1", "results.company", {"display_name", "__CLASS__"}, {"results.company.display_name", "results.company.__CLASS__"}),
    #"Expanded results.category" = Table.ExpandRecordColumn(#"Expanded results.company", "results.category", {"__CLASS__", "tag", "label"}, {"results.category.__CLASS__", "results.category.tag", "results.category.label"}),
    #"Expanded results.location" = Table.ExpandRecordColumn(#"Expanded results.category", "results.location", {"area", "__CLASS__", "display_name"}, {"results.location.area", "results.location.__CLASS__", "results.location.display_name"}),
    #"Expanded results.location.area" = Table.ExpandListColumn(#"Expanded results.location", "results.location.area"),
    #"Changed Type" = Table.TransformColumnTypes(#"Expanded results.location.area",{{"count", Int64.Type}, {"mean", type number}, {"__CLASS__", type text}, {"results.latitude", type number}, {"results.created", type datetime}, {"results.salary_min", type number}, {"results.description", type text}, {"results.id", Int64.Type}, {"results.salary_is_predicted", Int64.Type}, {"results.company.display_name", type text}, {"results.company.__CLASS__", type text}, {"results.redirect_url", type text}, {"results.longitude", type number}, {"results.contract_type", type any}, {"results.title", type text}, {"results.__CLASS__", type text}, {"results.adref", type text}, {"results.contract_time", type text}, {"results.category.__CLASS__", type text}, {"results.category.tag", type text}, {"results.category.label", type text}, {"results.salary_max", type number}, {"results.location.area", type text}, {"results.location.__CLASS__", type text}, {"results.location.display_name", type text}}),
    #"Appended Query" = Table.Combine({#"Changed Type", CanadaRaw, MexicoRaw})
in
    #"Appended Query"



///Appended query used to join us canada and Mexico markets and wher epythong script was executed

let
    Source = Json.Document(Web.Contents("https://api.adzuna.com/v1/api/jobs/us/search/1?app_id=4dc3e42c&app_key=insertyourapi&results_per_page=50&what=developer&where=united+states+mexico&content-type=application/json")),
    #"Converted to Table" = Table.FromRecords({Source}),
    #"Expanded results" = Table.ExpandListColumn(#"Converted to Table", "results"),
    #"Expanded results1" = Table.ExpandRecordColumn(#"Expanded results", "results", {"latitude", "created", "salary_min", "description", "id", "salary_is_predicted", "company", "redirect_url", "longitude", "contract_type", "title", "__CLASS__", "adref", "contract_time", "category", "salary_max", "location"}, {"results.latitude", "results.created", "results.salary_min", "results.description", "results.id", "results.salary_is_predicted", "results.company", "results.redirect_url", "results.longitude", "results.contract_type", "results.title", "results.__CLASS__", "results.adref", "results.contract_time", "results.category", "results.salary_max", "results.location"}),
    #"Expanded results.company" = Table.ExpandRecordColumn(#"Expanded results1", "results.company", {"display_name", "__CLASS__"}, {"results.company.display_name", "results.company.__CLASS__"}),
    #"Expanded results.category" = Table.ExpandRecordColumn(#"Expanded results.company", "results.category", {"__CLASS__", "tag", "label"}, {"results.category.__CLASS__", "results.category.tag", "results.category.label"}),
    #"Expanded results.location" = Table.ExpandRecordColumn(#"Expanded results.category", "results.location", {"area", "__CLASS__", "display_name"}, {"results.location.area", "results.location.__CLASS__", "results.location.display_name"}),
    #"Expanded results.location.area" = Table.ExpandListColumn(#"Expanded results.location", "results.location.area"),
    #"Changed Type" = Table.TransformColumnTypes(#"Expanded results.location.area",{{"count", Int64.Type}, {"mean", type number}, {"__CLASS__", type text}, {"results.latitude", type number}, {"results.created", type datetime}, {"results.salary_min", type number}, {"results.description", type text}, {"results.id", Int64.Type}, {"results.salary_is_predicted", Int64.Type}, {"results.company.display_name", type text}, {"results.company.__CLASS__", type text}, {"results.redirect_url", type text}, {"results.longitude", type number}, {"results.contract_type", type any}, {"results.title", type text}, {"results.__CLASS__", type text}, {"results.adref", type text}, {"results.contract_time", type text}, {"results.category.__CLASS__", type text}, {"results.category.tag", type text}, {"results.category.label", type text}, {"results.salary_max", type number}, {"results.location.area", type text}, {"results.location.__CLASS__", type text}, {"results.location.display_name", type text}}),
    #"Appended Query" = Table.Combine({#"Changed Type", CanadaRaw, MexicoRaw}),
    #"Removed Duplicates" = Table.Distinct(#"Appended Query", {"results.id"}),
    #"Reordered Columns" = Table.ReorderColumns(#"Removed Duplicates",{"__CLASS__", "mean", "count", "results.latitude", "results.created", "results.salary_min", "results.id", "results.salary_is_predicted", "results.company.display_name", "results.company.__CLASS__", "results.redirect_url", "results.longitude", "results.contract_type", "results.title", "results.__CLASS__", "results.adref", "results.contract_time", "results.category.__CLASS__", "results.category.tag", "results.category.label", "results.salary_max", "results.location.area", "results.location.__CLASS__", "results.location.display_name", "results.description"}),
    #"Run Python script" = Python.Execute("import pandas as pd#(lf)import nltk#(lf)from nltk.corpus import stopwords#(lf)from nltk.tokenize import word_tokenize, sent_tokenize#(lf)from nltk.stem import WordNetLemmatizer#(lf)from nltk.util import ngrams  # Add this line to import the ngrams function#(lf)import re#(lf)import langdetect#(lf)from langdetect import detect#(lf)#(lf)nltk.download('stopwords')#(lf)nltk.download('punkt')#(lf)nltk.download('wordnet')#(lf)nltk.download('omw-1.4')  # Add this line to download the missing package#(lf)#(lf)def normalize(text):#(lf)    text = re.sub(r'[^a-zA-Z0-9\s]', '', text)  # Modified to remove periods and other non-alphanumeric characters#(lf)    text = text.lower()#(lf)    text = re.sub(r'\s+', ' ', text)#(lf)    return text#(lf)#(lf)#(lf)def get_ngrams(words, n):#(lf)    return [' '.join(grams) for grams in ngrams(words, n)]#(lf)#(lf)def extract_skills(text, skills):#(lf)    stop_words = set(stopwords.words('english'))#(lf)    tokenized_sentences = sent_tokenize(text)#(lf)#(lf)    found_skills = []#(lf)    for sentence in tokenized_sentences:#(lf)        tokenized_words = word_tokenize(sentence.lower())#(lf)        tokenized_words = [word for word in tokenized_words if word.isalpha()]#(lf)        tokenized_words = [word for word in tokenized_words if word not in stop_words]#(lf)#(lf)        bigrams = get_ngrams(tokenized_words, 2)#(lf)        trigrams = get_ngrams(tokenized_words, 3)#(lf)#(lf)        lemmatized_words = lemmatize_words(tokenized_words)#(lf)        lemmatized_bigrams = lemmatize_words(bigrams)#(lf)        lemmatized_trigrams = lemmatize_words(trigrams)#(lf)#(lf)        all_grams = lemmatized_words + lemmatized_bigrams + lemmatized_trigrams#(lf)#(lf)        if any(substring in all_grams for substring in ['programming','programador', 'software', 'app', 'web', 'dev', 'developer', 'development', 'web development','object oriented programming']):#(lf)            all_grams = [gram for gram in all_grams if gram not in ['programming','programador', 'software', 'app', 'web', 'dev', 'developer', 'development', 'web development','object oriented programming']]#(lf)            all_grams.append('software developer')#(lf)        if any(substring in all_grams for substring in ['data','data analyst', 'data analysis']):#(lf)            all_grams = [gram for gram in all_grams if gram not in ['data','data analyst', 'data analysis']]#(lf)            all_grams.append('data analyst')#(lf)        for skill in skills:#(lf)            if skill in all_grams:#(lf)                found_skills.append(skill)#(lf)#(lf)    return found_skills#(lf)#(lf)def lemmatize_words(words):#(lf)    lemmatizer = WordNetLemmatizer()#(lf)    lemmatized_words = []#(lf)    for word in words:#(lf)        tokens = word.split(' ')#(lf)        lemmatized_tokens = [lemmatizer.lemmatize(token) for token in tokens]#(lf)        lemmatized_words.append(' '.join(lemmatized_tokens))#(lf)    return lemmatized_words#(lf)#(lf)#(lf)soft_skills_seed_words = [""Confiable"",""Problem Solvers"",""Creative Thinkers"",""Communicative Skills"",""Communication"", ""Problem solving"", ""Stress management"", ""Organization"", ""Prioritizing"", ""Planning"", ""Verbal communication"", ""Presentation"", ""Constructive feedback"", ""Active listening"", ""Self management"", ""Optimism"", ""Calmness"", ""Analysis"", ""Self motivation"", ""Logical reasoning"", ""Observation"", ""Brainstorming"", ""Decision making"", ""Collaboration"", ""Coordination"", ""Idea exchange"", ""Mediation"", ""Imagination"", ""Mind mapping"", ""Innovation"", ""Experimentation"", ""Questioning"", ""Authenticity"", ""Mentorship"", ""Generosity"", ""Cultural intelligence"", ""Empathy"", ""Humor"", ""Networking"", ""Tolerance"", ""Diplomacy"", ""Responsibility"", ""Discipline"", ""Dependability"", ""Commitment"", ""Professionalism"", ""Scheduling"", ""Introspection"", ""Acuity"", ""Critical observation"", ""Customer service"", ""Listening skills"", ""Self control"", ""Positive attitude"", ""Assertiveness"", ""Conflict resolution"", ""Depersonalization"", ""Taking responsibility"", ""Positivity"", ""Work ethic"", ""Flexibility"", ""Confidence"", ""Receptive attitude"", ""Patience"", ""Enthusiasm"", ""Critical thinking"", ""Sociability"", ""Persuasion"", ""Visual communication"", ""Aesthetics"", ""Accuracy"", ""System analysis"", ""Deductive reasoning"", ""Active learning"", ""Quality client service"", ""Strategic thinking"", ""Technical writing"", ""Team building"", ""Presentation and public thinking"", ""Patience"", ""Open mindedness"", ""Accountability"", ""Time management"", ""Problem solving"", ""Critical thinking"", ""Decision making"", ""Analytical skills"", ""Innovation management"", ""Creativity and Innovation"", ""Adaptability and Flexibility"", ""Resourcefulness"", ""Troubleshooting"", ""Root cause analysis"", ""Logical reasoning"", ""Complex problem solving"", ""Systems thinking"", ""Design thinking"", ""Innovation strategy"", ""Strategic thinking"", ""Time management"", ""Attention to detail"", ""Organization and planning"", ""Prioritization"", ""Goal setting"", ""Self discipline"", ""Perseverance and grit"", ""Resilience"", ""Stress management"", ""Emotional intelligence"", ""Empathy and compassion"", ""Conflict resolution"", ""Negotiation skills"", ""Persuasion"", ""Influence and persuasion"", ""Customer service"", ""Salesmanship"", ""Leadership"", ""Teamwork"", ""Collaboration"", ""Coordination"", ""Coaching and mentoring"", ""Teaching and instructing"", ""Facilitation"", ""Empowerment"", ""Delegation"", ""Feedback and coaching"", ""Trust building"", ""Relationship building"", ""Cultural competence"", ""Diversity and inclusion"", ""Respect for others"", ""Open mindedness"", ""Positive attitude"", ""Self awareness"", ""Self confidence"", ""Self motivation"", ""Self improvement"", ""Self management"", ""Passion for work"", ""Initiative taking"", ""Curiosity and learning"", ""Adaptation to change"", ""Risk taking"", ""Entrepreneurship"", ""Continuous improvement"", ""Innovation culture"", ""Interpersonal communication"", ""Verbal communication"", ""Nonverbal communication"",""Presentation skills"", ""Public speaking"", ""Active listening"", ""Conflict management"", ""Time management"", ""Customer focus"", ""Service orientation"", ""Team building"", ""Coaching and feedback"", ""Multitasking"", ""Decision making""]#(lf)soft_skills_seed_words = list(set(soft_skills_seed_words))#(lf)hard_skills_seed_words = [#(lf)    ""Written communication"",#(lf)    ""Python"",#(lf)    ""Java"",#(lf)    ""Excel"",#(lf)    ""Data analysis"",#(lf)    ""Project management"",#(lf)    ""Data visualization"",#(lf)    ""Machine learning"",#(lf)    ""SQL"",#(lf)    ""Database management"",#(lf)    ""Statistical analysis"",#(lf)    ""Business intelligence"",#(lf)    ""Data mining"",#(lf)    ""Data modeling"",#(lf)    ""Data management"",#(lf)    ""Data cleaning"",#(lf)    ""Data warehousing"",#(lf)    ""Data architecture"",#(lf)    ""Predictive modeling"",#(lf)    ""Data driven decision making"",#(lf)    ""Software development"",#(lf)    ""Programming languages"",#(lf)    ""Object oriented programming"",#(lf)    ""Software development"",""Software Developer"",#(lf)    ""Front end development"",#(lf)    ""Back end development"",#(lf)    ""Full stack development"",#(lf)    ""Mobile development"",#(lf)    ""iOS development"",#(lf)    ""Android development"",#(lf)    ""Cloud computing"",#(lf)    ""Network security"",#(lf)    ""Information security"",#(lf)    ""Cybersecurity"",#(lf)    ""DevOps"",#(lf)    ""Agile methodology"",#(lf)    ""Scrum"",#(lf)    ""Kanban"",#(lf)    ""Waterfall methodology"",#(lf)    ""Test driven development"",#(lf)    ""Continuous integration"",#(lf)    ""Continuous delivery"",#(lf)    ""Git"",#(lf)    ""Version control"",#(lf)    ""Quality assurance"",#(lf)    ""User experience design"",#(lf)    ""User interface design"",#(lf)    ""Graphic design"",#(lf)    ""Search engine optimization"",#(lf)    ""Digital marketing"",#(lf)    ""Content management systems"",#(lf)    ""Big data"",#(lf)    ""Artificial intelligence"",#(lf)    ""Natural language processing"",#(lf)    ""Computer vision"",#(lf)    ""Blockchain technology"",#(lf)    ""Internet of things"",#(lf)    ""Cloud architecture"",#(lf)    ""Cloud storage"",#(lf)    ""Cloud security"",#(lf)    ""Data privacy"",#(lf)    ""Data encryption"",#(lf)    ""Data forensics"",#(lf)    ""Network architecture"",#(lf)    ""Virtualization technology"",#(lf)    ""Server administration"",#(lf)    ""IT infrastructure"",#(lf)    ""Information governance"",#(lf)    ""Project planning"",#(lf)    ""Project scheduling"",#(lf)    ""Project coordination"",#(lf)    ""Resource management"",#(lf)    ""Risk management"",#(lf)    ""Business analysis"",#(lf)    ""Requirements gathering"",#(lf)    ""Product management"",#(lf)    ""Product development"",#(lf)    ""Product launch"",#(lf)    ""Market research"",#(lf)    ""Sales forecasting"",#(lf)    ""Financial analysis"",#(lf)    ""Financial planning"",#(lf)    ""Financial reporting"",#(lf)    ""Investment analysis"",#(lf)    ""Investment management"",#(lf)    ""Asset management"",#(lf)    ""Asset allocation"",#(lf)    ""Tax planning"",#(lf)    ""Auditing"",#(lf)    ""Accounting software"",#(lf)    ""Account reconciliation"",#(lf)    ""Bookkeeping"",#(lf)    ""Payroll administration"",#(lf)    ""Accounts payable"",#(lf)    ""Accounts receivable"",#(lf)    ""Cost accounting"",#(lf)    ""Managerial accounting"",#(lf)    ""Business law"",#(lf)    ""Employment law"",#(lf)    ""Intellectual property law"",#(lf)    ""Contract negotiation"",#(lf)    ""Procurement"",#(lf)    ""Supply chain management"",#(lf)    ""Logistics management"",#(lf)    ""Inventory management"",#(lf)    ""Distribution management"",#(lf)    ""Customer relationship management"",#(lf)    ""Sales management"",#(lf)    ""Sales operations"",#(lf)    ""Sales strategy"",#(lf)    ""Sales enablement"",#(lf)    ""Lead generation"",#(lf)    ""Lead nurturing"",#(lf)    ""Customer support"",#(lf)    ""Customer service management"",#(lf)    ""Call center management"",#(lf)    ""Technical support"",#(lf)    ""Field service management"",#(lf)    ""Operations management"",#(lf)    ""Process improvement"",#(lf)    ""Quality management"",#(lf)    ""Lean six sigma"",#(lf)    ""Business process reengineering"",#(lf)    ""Facilities management"",#(lf)    ""Real estate management"",#(lf)    ""Property management"",""Soporte Tecnico"",#(lf)    ""Construction management"",""Ecommerce"",""Financial"",""Sales"",""developer"",""data"",""commerce"",""branding"",""architect"",""business professional"",""Business development"",""Staffing"",""Programming developer"",#(lf)]#(lf)hard_skills_seed_words = list(set(hard_skills_seed_words))#(lf)soft_skills_seed_words = list(set(soft_skills_seed_words))#(lf)length_difference = len(hard_skills_seed_words) - len(soft_skills_seed_words)#(lf)#(lf)if length_difference > 0:#(lf)#(tab)additional_soft_skills = [""Sensitivity"", ""Determination"", ""Perceptiveness"", ""Self-regulation"", ""Team player"", ""Proactivity"", ""Goal oriented"", ""Adaptable"", ""Compassionate"", #(tab)""Diligent"", ""Ambitious"", ""Reliable"", ""Integrity"", ""Pragmatic"", ""Intuitive"", ""Strategic"", ""Focused"", ""Efficient"", ""Analytical"", ""Resourceful"", ""Respectful"", ""Responsive"", #(tab)""Versatile"", ""Inquisitive"", ""Objective"", ""Sincere"", ""Energetic"", ""Persuasive"", ""Tactful"", ""Attentive"", ""Inventive"", ""Initiative"", ""Consistency"", ""Humility"", ""Responsible"", #(tab)""Punctuality"", ""Courage"", ""Influential"", ""Vigilance"", ""Perceptive"", ""Loyalty"", ""Resolute"", ""Self-starter"", ""Detail-oriented"", ""Foresight"", ""Honesty"", ""Tenacity"", #(tab)""Discernment"", ""Practical"", ""Self-sufficient"", ""Intelligent"", ""Agile"", ""Independent"", ""Creative"", ""Solution oriented"", ""Multicultural awareness"", ""Composure"", ""Diplomatic"", #(tab)""Adaptive"", ""Consistent"", ""Enterprising"", ""Problem identifier"", ""Risk-aware"", ""Curious"", ""Articulate"", ""Initiator"", ""Gracious"", ""Innovative"", ""Good judgment"", ""Strategist"", #(tab)""Cooperative"", ""Supportive"", ""Perseverant"", ""Direct"", ""Transparent"", ""Reflective"", ""Dedicated"", ""Good listener"", ""Empathetic"", ""Trustworthy"", ""Decisive"", ""Motivated"", #(tab)""Professional"", ""Proactive"", ""Ethical"", ""Methodical"", ""Conscientious"", ""Assertive"", ""Growth mindset"", ""Courageous"", ""Collaborative"", ""Approachable"", ""Fair"", ""Organized"", #(tab)""Self-aware"", ""Self-directed"", ""Visionary"", ""Enthusiastic"", ""Humble"", ""Rational"", ""Inclusive"", ""Persistent"", ""Driven"", ""Charismatic"", ""Results oriented"", ""Credible"", #(tab)""Genuine"", ""Realistic"", ""Grounded"", ""Prudent"", ""Sensible"", ""Self assured"", ""Tolerant"", ""Appreciative"", ""Curiosity"", ""Persistence"", ""Initiative"", ""Imaginative"", #(tab)""Anticipatory"", ""Strategic thinking"", ""Inspiring"", ""Flexible""]#(lf)#(tab)soft_skills_seed_words.extend(additional_soft_skills[:length_difference])#(lf)else:#(lf)#(tab)additional_hard_skills = [""Machine Learning Engineer"", ""UI/UX Designer"", ""Data Scientist"", ""Web Developer"", ""Mobile App Developer"", ""Data Analyst"", ""Network Administrator"", #(tab)""Security Analyst"", ""Cloud Architect"", ""Systems Analyst"", ""Database Administrator"", ""IT Support Specialist"", ""Technical Writer"", ""IT Project Manager"", ""SEO Specialist"", #(tab)""Social Media Manager"", ""Content Creator"", ""Game Developer"", ""Augmented Reality Developer"", ""Virtual Reality Developer"", ""Digital Marketing Manager"", ""Automation Engineer"", #(tab)""Business Analyst"", ""IT Consultant"", ""Sales Engineer"", ""DevOps Engineer"", ""Data Engineer"", ""Ethical Hacker"", ""Embedded Systems Engineer"", ""Product Designer"", ""RPA #(tab)Developer"", ""AI Developer"", ""Computer Vision Engineer""]#(lf)#(lf)# Normalize hard skill seed words#(lf)normalized_seed_words = [normalize(word) for word in soft_skills_seed_words]#(lf)normalized_hard_skills_seed_words = [normalize(word) for word in hard_skills_seed_words]#(lf)if len(set(normalized_seed_words)) != len(normalized_seed_words):#(lf)    print(""Warning: There are repeated words in the soft_skills list."")#(lf)if len(set(normalized_hard_skills_seed_words)) != len(normalized_hard_skills_seed_words):#(lf)    print(""Warning: There are repeated words in the hard_skills list."")#(lf)#(lf)#(lf)def detect_language(text):#(lf)    try:#(lf)        return detect(text)#(lf)    except:#(lf)        return ""unknown""#(lf)#(lf)def process_data(dataset, soft_skills, hard_skills):#(lf)    dataset['results.description'] = dataset['results.description'].apply(normalize)#(lf)    dataset['found_soft_skills'] = dataset['results.description'].apply(lambda x: extract_skills(x, soft_skills))#(lf)    dataset['found_hard_skills'] = dataset['results.description'].apply(lambda x: extract_skills(x, hard_skills))#(lf)    dataset['language'] = dataset['results.description'].apply(detect_language)  # Add this line#(lf)    return dataset#(lf)your_dataframe = dataset  # <- Replace this line with your actual DataFrame#(lf)#(lf)#(lf)#(lf)#(lf)# Process the data to extract soft skills#(lf)processed_df = process_data(your_dataframe, normalized_seed_words, normalized_hard_skills_seed_words)#(lf)#(lf)#(lf)# Return the new dataframe with the additional column#(lf)print(processed_df)#(lf)#(lf)",[dataset=#"Reordered Columns"]),
    processed_df = #"Run Python script"{[Name="processed_df"]}[Value],
    #"Changed Type1" = Table.TransformColumnTypes(processed_df,{{"__CLASS__", type text}, {"mean", type number}, {"count", Int64.Type}, {"results.latitude", type number}, {"results.created", type datetime}, {"results.salary_min", type number}, {"results.description", type text}, {"results.id", Int64.Type}, {"results.salary_is_predicted", Int64.Type}, {"results.company.display_name", type text}, {"results.company.__CLASS__", type text}, {"results.redirect_url", type text}, {"results.longitude", type number}, {"results.contract_type", type text}, {"results.title", type text}, {"results.__CLASS__", type text}, {"results.adref", type text}, {"results.contract_time", type text}, {"results.category.__CLASS__", type text}, {"results.category.tag", type text}, {"results.category.label", type text}, {"results.salary_max", type number}, {"results.location.area", type text}, {"results.location.__CLASS__", type text}, {"results.location.display_name", type text}, {"found_soft_skills", type text}}),
    #"Filtered Rows" = Table.SelectRows(#"Changed Type1", each true),
    #"Replaced Value" = Table.ReplaceValue(#"Filtered Rows","[]","",Replacer.ReplaceText,{"found_soft_skills", "found_hard_skills"}),
    #"Replaced Value1" = Table.ReplaceValue(#"Replaced Value","'","",Replacer.ReplaceText,{"found_soft_skills", "found_hard_skills"}),
    #"Replaced Value2" = Table.ReplaceValue(#"Replaced Value1","[","",Replacer.ReplaceText,{"found_soft_skills", "found_hard_skills"}),
    #"Replaced Value3" = Table.ReplaceValue(#"Replaced Value2","]","",Replacer.ReplaceText,{"found_soft_skills", "found_hard_skills"}),
    #"Replaced Value4" = Table.ReplaceValue(#"Replaced Value3","problem solvers","problem solving",Replacer.ReplaceText,{"found_soft_skills"}),
    #"Renamed Columns" = Table.RenameColumns(#"Replaced Value4",{{"results.location.display_name", "City and State (Ciudad y Estado)"}, {"results.location.area", "Country (País)"}, {"results.category.tag", "Job Category"}, {"results.company.display_name", "Company Offering"}, {"results.salary_min", "Min Salary"}, {"results.created", "results.created(Fecha publicada)"}, {"results.latitude", "Latitude Resultados"}, {"found_soft_skills", "found_soft_skills(HabilidadesBlandas)"}, {"found_hard_skills", "HardSkill"}}),
    #"Replaced Value5" = Table.ReplaceValue(#"Renamed Columns","relationship","Building Relations",Replacer.ReplaceText,{"found_soft_skills(HabilidadesBlandas)"}),
    #"Capitalized Each Word" = Table.TransformColumns(#"Replaced Value5",{{"found_soft_skills(HabilidadesBlandas)", Text.Proper, type text}, {"HardSkill", Text.Proper, type text}})
in
    #"Capitalized Each Word"




//Referenced query used to add mean, trasnform data and traslate the soft skills
let
    TranslateText = (inputText as text, sourceLanguage as text, targetLanguage as text) =>
        let
            url = "https://api.mymemory.translated.net/get?q=" & Uri.EscapeDataString(inputText) & "&langpair=" & sourceLanguage & "|" & targetLanguage,
            jsonResponse = Json.Document(Web.Contents(url)),
            translatedText = jsonResponse[#"responseData"][#"translatedText"]
        in
            translatedText,

    Source = BaseDataApi,
    #"Split Column by Delimiter" = Table.ExpandListColumn(Table.TransformColumns(Source, {{"found_soft_skills(HabilidadesBlandas)", Splitter.SplitTextByDelimiter(",", QuoteStyle.Csv), let itemType = (type nullable text) meta [Serialized.Text = true] in type {itemType}}}), "found_soft_skills(HabilidadesBlandas)"),
    #"Changed Type" = Table.TransformColumnTypes(#"Split Column by Delimiter",{{"found_soft_skills(HabilidadesBlandas)", type text}}),
    #"Split Column by Delimiter1" = Table.ExpandListColumn(Table.TransformColumns(#"Changed Type", {{"HardSkill", Splitter.SplitTextByDelimiter(",", QuoteStyle.Csv), let itemType = (type nullable text) meta [Serialized.Text = true] in type {itemType}}}), "HardSkill"),
    #"Changed Type1" = Table.TransformColumnTypes(#"Split Column by Delimiter1",{{"HardSkill", type text}}),
    #"Renamed Columns" = Table.RenameColumns(#"Changed Type1",{{"Country (País)", "Country"}, {"HardSkill", "HardSkill"}, {"found_soft_skills(HabilidadesBlandas)", "SoftSkill"}}),
    #"Trimmed Text" = Table.TransformColumns(#"Renamed Columns",{{"SoftSkill", Text.Trim, type text}, {"HardSkill", Text.Trim, type text}}),
    #"Cleaned Text" = Table.TransformColumns(#"Trimmed Text",{{"SoftSkill", Text.Clean, type text}}),
    #"Renamed Columns1" = Table.RenameColumns(#"Cleaned Text",{{"results.salary_max", "SalarioMaximo"}, {"Company Offering", "Empresa"}}),
    #"Replaced Value1" = Table.ReplaceValue(#"Renamed Columns1","-"," ",Replacer.ReplaceText,{"Job Category"}),
    #"Translated SoftSkill" = Table.AddColumn(#"Replaced Value1", "SoftSkill_translated", each TranslateText([SoftSkill], "en", "es")),
    #"Translated Job Category" = Table.AddColumn(#"Translated SoftSkill", "Job Category Translated", each TranslateText([Job Category], "en", "es")),
    #"Renamed Columns2" = Table.RenameColumns(#"Translated Job Category",{{"Job Category Translated", "Cargo Traducido"}}),
    #"Capitalized Each Word1" = Table.TransformColumns(#"Renamed Columns2",{{"Cargo Traducido", Text.Proper, type text}}),
    #"Added Custom" = Table.AddColumn(#"Capitalized Each Word1", "SalarioPromedio", each ([SalarioMaximo] + [Min Salary]) / 2),
    #"Replaced Value" = Table.ReplaceValue(#"Added Custom","NO QUERY SPECIFIED. EXAMPLE REQUEST: GET?Q=HELLO&LANGPAIR=EN|IT","",Replacer.ReplaceText,{"SoftSkill_translated"})
in
    #"Replaced Value"
